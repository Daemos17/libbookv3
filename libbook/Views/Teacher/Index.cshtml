@using datamodel
@model IEnumerable<vTeacher>
@{
    ViewBag.Title = "Index";
}

<div class="form-group">
    <label for="fioTeacher">ФИО Преподавателя</label>
    <input type="text" class="form-control" id="fioTeacher" aria-describedby="fioTeacherHelp" placeholder="Введите фио преподавателя">
    <small id="fioTeacherHelp" class="form-text text-muted">Начните вводить фамилию Преподавателя. Через пробел можно указать Имя и Отчество</small>
</div>

<table class="table table-hover" id="teacherTable">
    <thead>
        <tr id="tableHead">
            <th scope="col">№</th>
            <th scope="col">Фамилия</th>
            <th scope="col">Имя</th>
            <th scope="col">Отчество</th>
            <th scope="col">Комментарий</th>
        </tr>
    </thead>
    <tbody>
        @{
            int i = 1;
            foreach (var teacher in Model)
            {
                <tr id="@teacher.Id" class="teacher">
                    <td>@i</td>
                    <td>@teacher.FirstName</td>
                    <td>@teacher.SecondName</td>
                    <td>@teacher.LastName</td>
                    <td>@teacher.Comment</td>
                    <td>
                        @Html.ActionLink("Удалить", "Delete",
                                new { id = teacher.Id }, new { @id = "myLink" })
                    </td>
                    <td><a href="Teacher/Edit/@teacher.Id">Редактировать</a></td>
                </tr>
                i++;
            }
        }

    </tbody>
</table>


<script type="text/javascript">

    $(document).ready(function () {
        //выбор из таблицы преподавателй
        $('#teacherTable').on('click', 'tbody tr', function (event) {
            console.log($(this).attr('id'));

            $('#teacherTable tr').removeClass('active');
            $(this).addClass('active');
        });

        //ввод в поле фио
        var teacherInput = $('#fioTeacher');

        teacherInput.keyup(function () {
            var t = teacherInput.val();
            if (t.length >= 3) {
                $('#teacherTable').find('tr').removeClass('active');
                $.get("/Teacher/Autocomplete", {
                    term: t
                }, function (data) {
                    createTableTeacher(data);
                });
            }
            if (t.length == 0) {
                $('#teacherTable').find('tr').removeClass('active');
                $('#teacherTable').find('tr[class=teacher]').show();

                $('#teacherTable').find('tr[class=autoselectRow]').remove();
                }
            }
        );

        //заполнение таблицы преподавателей
    function createTableTeacher(data) {
        var tableRows = $('#teacherTable').find('tr[class=teacher]').hide();
            //for (var i = 1; i < tableRows.length; i++) {
            //    tableRows[i].hidden();
            //}

            for (i = 0; i < data.teacher.length; i++) {
                $('#teacherTable > tbody').append('<tr id=' + data.teacher[i].Id + ' class=autoselectRow></tr>');
                $('#teacherTable > tbody > tr:last').append('<td id="teacherId" hidden>' + data.teacher[i].Id + '</td>');
                $('#teacherTable > tbody > tr:last').append('<td>' + (i + 1) + '</td>');
                $('#teacherTable > tbody > tr:last').append('<td>' + data.teacher[i].FirstName + '</td>');
                $('#teacherTable > tbody > tr:last').append('<td>' + data.teacher[i].SecondName + '</td>');
                $('#teacherTable > tbody > tr:last').append('<td>' + data.teacher[i].LastName + '</td>');
                $('#teacherTable > tbody > tr:last').append('<td>' + data.teacher[i].Comment + '</td>');
                $('#teacherTable > tbody > tr:last').append('<td><a href=Teacher/Delete/' + data.teacher[i].Id + '>Удалить</a></td>');
                $('#teacherTable > tbody > tr:last').append('<td><a href=Teacher/Edit/'+data.teacher[i].Id+'>Редактировать</a></td>');
                
            }
            if (data.teacher.length == 1) {
                $('#teacherTable > tbody > tr:last').click();
            }
        }
    });

</script>